<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒã‚¸ãƒƒã‚¯ãƒ¯ãƒ¼ãƒ‰å¤‰æ›ã‚²ãƒ¼ãƒ </title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 900px;
            width: 100%;
            display: flex;
            flex-direction: column;
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 10px;
            font-size: 28px;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }

        .progress-bar {
            background: #e0e0e0;
            height: 8px;
            border-radius: 4px;
            margin-bottom: 30px;
            overflow: hidden;
        }

        .progress-fill {
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            height: 100%;
            transition: width 0.3s ease;
        }

        .question-container {
            margin-bottom: 30px;
        }

        .question-number {
            color: #667eea;
            font-weight: bold;
            font-size: 14px;
            margin-bottom: 10px;
        }

        /* ===== Phase 1: Word Selection ===== */
        .phase-1 {
            display: none;
        }

        .instruction {
            background: #e7f3ff;
            border-left: 4px solid #667eea;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 4px;
            color: #333;
            font-size: 14px;
        }

        .question-text {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            font-size: 16px;
            line-height: 2;
            color: #333;
            margin-bottom: 20px;
            word-wrap: break-word;
        }

        .word-token {
            display: inline-block;
            background: white;
            border: 2px solid #e0e0e0;
            padding: 8px 12px;
            margin: 4px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.2s ease;
            user-select: none;
        }

        .word-token:hover {
            background: #f0f0f0;
            border-color: #667eea;
            transform: scale(1.05);
        }

        .word-token.selected {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .selected-words {
            background: #f9f9f9;
            border: 2px dashed #ffc107;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            min-height: 50px;
        }

        .selected-words-label {
            font-size: 12px;
            color: #666;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .selected-word-tag {
            display: inline-block;
            background: #ffc107;
            color: #333;
            padding: 6px 12px;
            margin: 4px;
            border-radius: 15px;
            font-size: 13px;
            font-weight: bold;
        }

        .selected-word-tag .remove-btn {
            margin-left: 6px;
            cursor: pointer;
            font-weight: bold;
        }

        .selected-word-tag .remove-btn:hover {
            opacity: 0.7;
        }

        .no-selection {
            color: #999;
            font-size: 13px;
        }

        /* ===== Phase 2: Conversion Input ===== */
        .phase-2 {
            display: none;
        }

        .conversion-item {
            margin-bottom: 25px;
            padding: 15px;
            background: #f9f9f9;
            border-radius: 10px;
        }

        .conversion-label {
            font-size: 13px;
            color: #333;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .conversion-label .magic-word {
            display: inline-block;
            background: #fff3cd;
            border: 2px dashed #ffc107;
            padding: 4px 8px;
            border-radius: 6px;
            color: #ff6b6b;
            margin: 0 5px;
        }

        .conversion-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .conversion-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        /* ===== Phase 3: Result ===== */
        .phase-3 {
            display: none;
        }

        .result-text-container {
            background: #e8f5e9;
            border: 2px solid #28a745;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .result-label {
            font-size: 12px;
            color: #333;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .result-text {
            font-size: 18px;
            color: #155724;
            line-height: 1.8;
            word-wrap: break-word;
        }

        .button-group {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 25px;
        }

        button {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-submit {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            flex: 1;
        }

        .btn-submit:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .btn-submit:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-next {
            background: #28a745;
            color: white;
            flex: 1;
        }

        .btn-next:hover {
            background: #218838;
            transform: translateY(-2px);
        }

        .btn-back {
            background: #6c757d;
            color: white;
            flex: 0.5;
        }

        .btn-back:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }

        .btn-restart {
            background: #6c757d;
            color: white;
            flex: 1;
        }

        .btn-restart:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }

        .feedback {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            display: none;
            font-weight: bold;
            text-align: center;
        }

        .feedback.error {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
            display: block;
        }

        .result-container {
            display: none;
            text-align: center;
        }

        .result-container h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 24px;
        }

        .score-display {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .score-display .score {
            font-size: 48px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .score-display .score-label {
            font-size: 14px;
            opacity: 0.9;
        }

        .score-display .message {
            margin-top: 15px;
            font-size: 16px;
        }

        @media (max-width: 600px) {
            .container {
                padding: 20px;
            }

            h1 {
                font-size: 22px;
            }

            .question-text {
                font-size: 14px;
            }

            .button-group {
                flex-direction: column;
            }

            .options-group {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>âœ¨ ãƒã‚¸ãƒƒã‚¯ãƒ¯ãƒ¼ãƒ‰å¤‰æ›ã‚²ãƒ¼ãƒ </h1>
        <p class="subtitle">ãƒã‚¸ãƒƒã‚¯ãƒ¯ãƒ¼ãƒ‰ã‚’è¦‹ã¤ã‘ã¦ã€å…·ä½“çš„ãªæ–‡ç« ã«å¤‰æ›ã—ã‚ˆã†ï¼</p>

        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>

        <div id="gameContainer" class="question-container">
            <div class="question-number" id="questionNumber"></div>

            <!-- Phase 1: Word Selection -->
            <div class="phase-1" id="phase1">
                <div class="instruction">
                    ğŸ“Œ ä¸‹ã®æ–‡ã‹ã‚‰ã€Œãƒã‚¸ãƒƒã‚¯ãƒ¯ãƒ¼ãƒ‰ã€ï¼ˆæŠ½è±¡çš„ã§è¤‡æ•°ã®æ„å‘³ã‚’æŒã¤ãƒ¯ãƒ¼ãƒ‰ï¼‰ã‚’é¸ã‚“ã§ãã ã•ã„ã€‚
                </div>
                <div class="question-text" id="questionText"></div>
                <div class="selected-words" id="selectedWords">
                    <div class="selected-words-label">é¸æŠã—ãŸãƒã‚¸ãƒƒã‚¯ãƒ¯ãƒ¼ãƒ‰:</div>
                    <div class="no-selection">ï¼ˆã¾ã é¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“ï¼‰</div>
                </div>
                <div class="button-group">
                    <button class="btn-submit" id="phase1NextBtn">é¸æŠå®Œäº† â†’ æ¬¡ã¸</button>
                </div>
                <div class="feedback" id="phase1Feedback"></div>
            </div>

            <!-- Phase 2: Conversion Input -->
            <div class="phase-2" id="phase2">
                <div class="instruction">
                    ğŸ“Œ é¸æŠã—ãŸãƒã‚¸ãƒƒã‚¯ãƒ¯ãƒ¼ãƒ‰ã”ã¨ã«ã€å…·ä½“çš„ãªè¨€è‘‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚
                </div>
                <div class="question-text" id="questionTextPhase2"></div>
                <div id="conversionContainer"></div>
                <div class="button-group">
                    <button class="btn-back" id="phase2BackBtn">æˆ»ã‚‹</button>
                    <button class="btn-submit" id="phase2NextBtn">ç¢ºèª â†’ çµæœã‚’è¦‹ã‚‹</button>
                </div>
                <div class="feedback" id="phase2Feedback"></div>
            </div>

            <!-- Phase 3: Result -->
            <div class="phase-3" id="phase3">
                <div class="instruction">
                    ğŸ“Œ å¤‰æ›å¾Œã®æ–‡ç« ã§ã™ã€‚
                </div>
                <div class="result-text-container">
                    <div class="result-label">å¤‰æ›å¾Œã®æ–‡ç« :</div>
                    <div class="result-text" id="resultText"></div>
                </div>
                <div class="button-group" id="phase3ButtonGroup">
                    <button class="btn-back" id="phase3BackBtn">æˆ»ã‚‹</button>
                    <button class="btn-next" id="phase3NextBtn">æ¬¡ã®å•é¡Œã¸</button>
                </div>
            </div>
        </div>

        <div id="resultContainer" class="result-container">
            <h2>ğŸ‰ ã‚²ãƒ¼ãƒ å®Œäº†</h2>
            <div class="score-display">
                <div class="score-label">å®Œäº†ã—ãŸå•é¡Œæ•°</div>
                <div class="score" id="finalScore">0/0</div>
                <div class="message" id="resultMessage"></div>
            </div>
            <div class="button-group">
                <button class="btn-restart" id="restartBtn">ã‚‚ã†ä¸€åº¦ãƒ—ãƒ¬ã‚¤</button>
            </div>
        </div>
    </div>

    <script>
        const questions = [
            {
                text: 'é©åº¦ãªé‹å‹•ã¨ãƒãƒ©ãƒ³ã‚¹ã®è‰¯ã„é£Ÿäº‹ãŒå¤§åˆ‡ã§ã™ã€‚ã—ã£ã‹ã‚Šç¡çœ ã‚’ã¨ã£ã¦ã€å¥åº·çš„ãªç”Ÿæ´»ã‚’é€ã‚Šã¾ã—ã‚‡ã†ã€‚',
                words: [
                    { word: 'é©åº¦' },
                    { word: 'é‹å‹•' },
                    { word: 'ãƒãƒ©ãƒ³ã‚¹ã®è‰¯ã„' },
                    { word: 'é£Ÿäº‹' },
                    { word: 'å¤§åˆ‡' },
                    { word: 'ã—ã£ã‹ã‚Š' },
                    { word: 'ç¡çœ ' },
                    { word: 'å¥åº·çš„' },
                    { word: 'ç”Ÿæ´»' }
                ]
            },
            {
                text: 'ãƒãƒ¼ãƒ ãŒå¼·ããªã‚‹ã«ã¯ã€ãƒãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã¨ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒé‡è¦ã§ã™ã€‚å®šæœŸçš„ã«ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’é–‹ã„ã¦ã€æƒ…å ±ã‚’å…±æœ‰ã—ã¾ã—ã‚‡ã†ã€‚',
                words: [
                    { word: 'å¼·ããªã‚‹' },
                    { word: 'æˆåŠŸ' },
                    { word: 'ãƒãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯' },
                    { word: 'ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³' },
                    { word: 'é‡è¦' },
                    { word: 'å®šæœŸçš„ã«' },
                    { word: 'ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°' },
                    { word: 'æƒ…å ±' },
                    { word: 'å…±æœ‰' }
                ]
            },
            {
                text: 'å­¦åŠ›ã‚’å‘ä¸Šã•ã›ã‚‹ãŸã‚ã«ã¯ã€å­¦ç¿’ã®è³ªã‚’é«˜ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ç›®æ¨™è¨­å®šã—ç¶™ç¶šçš„ã«æ”¹å–„ã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚',
                words: [
                    { word: 'å­¦åŠ›' },
                    { word: 'å‘ä¸Šã•ã›ã‚‹' },
                    { word: 'å­¦ç¿’ã®è³ªã‚’é«˜ã‚ã‚‹' },
                    { word: 'ç›®æ¨™è¨­å®šã—' },
                    { word: 'ç¶™ç¶šçš„ã«' },
                    { word: 'æ”¹å–„' }
                ]
            }
        ];

        let currentQuestion = 0;
        let selectedWords = [];
        let userConversions = {};
        let currentPhase = 1;
        let allResults = []; // å…¨å•é¡Œã®çµæœã‚’ä¿å­˜

        function tokenizeText(text) {
            // å¥èª­ç‚¹ã¨åŠ©è©ãƒ»åŠ©å‹•è©ã§åˆ†å‰²
            const tokens = [];
            let currentToken = '';

            for (let i = 0; i < text.length; i++) {
                const char = text[i];
                const nextChar = text[i + 1] || '';

                // å¥èª­ç‚¹ã®å ´åˆ
                if (char === 'ã€' || char === 'ã€‚') {
                    if (currentToken) {
                        tokens.push(currentToken);
                        currentToken = '';
                    }
                    tokens.push(char);
                    continue;
                }

                // ã‚¹ãƒšãƒ¼ã‚¹ã®å ´åˆ
                if (/\s/.test(char)) {
                    if (currentToken) {
                        tokens.push(currentToken);
                        currentToken = '';
                    }
                    tokens.push(char);
                    continue;
                }

                currentToken += char;

                // åŠ©è©ãƒ»åŠ©å‹•è©ã§åˆ†å‰²ã™ã‚‹ã‹åˆ¤å®š
                const auxiliaries = ['ãŒ', 'ã‚’', 'ã«', 'ã¸', 'ã‹ã‚‰', 'ã¾ã§', 'ã‚ˆã‚Š', 'ã¨', 'ã‚„', 'ã‚‚', 'ã®ã§', 'ã¦', 'ãŸ', 'ã¾ã™', 'ã§ã™'];
                let shouldSplit = false;

                for (let aux of auxiliaries) {
                    if (currentToken.endsWith(aux) && currentToken.length > aux.length) {
                        const beforeAux = currentToken.slice(0, -aux.length);
                        tokens.push(beforeAux);
                        tokens.push(aux);
                        currentToken = '';
                        shouldSplit = true;
                        break;
                    }
                }
            }

            if (currentToken) {
                tokens.push(currentToken);
            }

            return tokens.filter(t => t.length > 0);
        }

        function init() {
            currentQuestion = 0;
            loadQuestion();
        }

        function loadQuestion() {
            const question = questions[currentQuestion];
            const totalQuestions = questions.length;

            const progress = ((currentQuestion + 1) / totalQuestions) * 100;
            document.getElementById('progressFill').style.width = progress + '%';

            document.getElementById('questionNumber').textContent = `å•é¡Œ ${currentQuestion + 1} / ${totalQuestions}`;

            // Phase 1: Word Selection
            selectedWords = [];
            userConversions = {};
            currentPhase = 1;
            showPhase(1);

            // é¸æŠã—ãŸãƒã‚¸ãƒƒã‚¯ãƒ¯ãƒ¼ãƒ‰æ¬„ã‚’ãƒªã‚»ãƒƒãƒˆ
            updateSelectedWordsDisplay();

            // wordsã«å®šç¾©ã•ã‚Œã¦ã„ã‚‹ãƒ¯ãƒ¼ãƒ‰ã«åŸºã¥ã„ã¦ãƒ†ã‚­ã‚¹ãƒˆã‚’ãƒˆãƒ¼ã‚¯ãƒ³åŒ–
            let htmlContent = question.text;
            const sortedWords = [...question.words].sort((a, b) => b.word.length - a.word.length);

            sortedWords.forEach(wordObj => {
                const word = wordObj.word;
                const regex = new RegExp(word.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'g');
                htmlContent = htmlContent.replace(regex, `<span class="word-token" data-word="${word}">${word}</span>`);
            });

            document.getElementById('questionText').innerHTML = htmlContent;

            document.querySelectorAll('#phase1 .word-token').forEach(token => {
                token.addEventListener('click', toggleWordSelection);
            });

            document.getElementById('phase1Feedback').style.display = 'none';
        }

        function toggleWordSelection(e) {
            const word = e.target.dataset.word;
            const index = selectedWords.indexOf(word);

            if (index > -1) {
                selectedWords.splice(index, 1);
                e.target.classList.remove('selected');
            } else {
                selectedWords.push(word);
                e.target.classList.add('selected');
            }

            updateSelectedWordsDisplay();
        }

        function updateSelectedWordsDisplay() {
            const container = document.getElementById('selectedWords');

            if (selectedWords.length === 0) {
                container.innerHTML = '<div class="selected-words-label">é¸æŠã—ãŸãƒã‚¸ãƒƒã‚¯ãƒ¯ãƒ¼ãƒ‰:</div><div class="no-selection">ï¼ˆã¾ã é¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“ï¼‰</div>';
            } else {
                let html = '<div class="selected-words-label">é¸æŠã—ãŸãƒã‚¸ãƒƒã‚¯ãƒ¯ãƒ¼ãƒ‰:</div>';
                selectedWords.forEach(word => {
                    html += `<span class="selected-word-tag">${word}<span class="remove-btn" onclick="removeWord('${word}')">âœ•</span></span>`;
                });
                container.innerHTML = html;
            }
        }

        function removeWord(word) {
            const index = selectedWords.indexOf(word);
            if (index > -1) {
                selectedWords.splice(index, 1);
            }
            document.querySelectorAll('.word-token').forEach(token => {
                if (token.dataset.word === word) {
                    token.classList.remove('selected');
                }
            });
            updateSelectedWordsDisplay();
        }

        function phase1Next() {
            if (selectedWords.length === 0) {
                document.getElementById('phase1Feedback').style.display = 'block';
                document.getElementById('phase1Feedback').className = 'feedback error';
                document.getElementById('phase1Feedback').textContent = 'ãƒã‚¸ãƒƒã‚¯ãƒ¯ãƒ¼ãƒ‰ã‚’1ã¤ä»¥ä¸Šé¸æŠã—ã¦ãã ã•ã„ï¼';
                return;
            }

            currentPhase = 2;
            showPhase(2);
            generateConversionOptions();
        }

        function generateConversionOptions() {
            const question = questions[currentQuestion];
            const container = document.getElementById('conversionContainer');
            container.innerHTML = '';

            // å•é¡Œæ–‡ã‚’è¡¨ç¤ºï¼ˆé¸æŠã—ãŸãƒ¯ãƒ¼ãƒ‰ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆï¼‰
            let htmlContent = question.text;
            const sortedWords = [...selectedWords].sort((a, b) => b.length - a.length);

            sortedWords.forEach(word => {
                const regex = new RegExp(word.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'g');
                htmlContent = htmlContent.replace(regex, `<span class="word-token" style="background: #667eea; color: white;">${word}</span>`);
            });

            document.getElementById('questionTextPhase2').innerHTML = htmlContent;

            // å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ç”Ÿæˆ
            selectedWords.forEach((word, index) => {
                const div = document.createElement('div');
                div.className = 'conversion-item';

                const label = document.createElement('div');
                label.className = 'conversion-label';
                label.innerHTML = `<span class="magic-word">${word}</span> ã‚’å…·ä½“çš„ã«:`;

                const input = document.createElement('input');
                input.type = 'text';
                input.className = 'conversion-input';
                input.id = `conversion-${index}`;
                input.placeholder = 'å…·ä½“çš„ãªè¨€è‘‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„';
                input.addEventListener('input', (e) => {
                    userConversions[word] = e.target.value;
                });

                div.appendChild(label);
                div.appendChild(input);
                container.appendChild(div);
            });

            // æœ€åˆã®å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹
            setTimeout(() => {
                const firstInput = document.getElementById('conversion-0');
                if (firstInput) firstInput.focus();
            }, 100);

            document.getElementById('phase2Feedback').style.display = 'none';
        }

        function phase2Next() {
            const allFilled = selectedWords.every(word =>
                userConversions[word] !== undefined && userConversions[word].trim() !== ''
            );

            if (!allFilled) {
                document.getElementById('phase2Feedback').style.display = 'block';
                document.getElementById('phase2Feedback').className = 'feedback error';
                document.getElementById('phase2Feedback').textContent = 'ã™ã¹ã¦ã®ãƒã‚¸ãƒƒã‚¯ãƒ¯ãƒ¼ãƒ‰ã«å…¥åŠ›ã—ã¦ãã ã•ã„ï¼';
                return;
            }

            currentPhase = 3;
            showPhase(3);
            generateResultText();
        }

        function generateResultText() {
            const question = questions[currentQuestion];
            let resultText = question.text;

            // é•·ã„å˜èªã‹ã‚‰ç½®æ›ï¼ˆçŸ­ã„å˜èªã‚’å…ˆã«ç½®æ›ã—ã¦é•·ã•ãŒå¤‰ã‚ã‚‹ã®ã‚’é¿ã‘ã‚‹ï¼‰
            const sortedWords = [...selectedWords].sort((a, b) => b.length - a.length);

            sortedWords.forEach(word => {
                const conversion = userConversions[word];
                const regex = new RegExp(word.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'g');
                resultText = resultText.replace(regex, conversion);
            });

            // çµæœã‚’ä¿å­˜
            allResults[currentQuestion] = resultText;

            document.getElementById('resultText').textContent = resultText;
        }

        function phase2Back() {
            currentPhase = 1;
            showPhase(1);
        }

        function phase3Back() {
            currentPhase = 2;
            showPhase(2);
        }

        function phase3Next() {
            if (currentQuestion < questions.length - 1) {
                currentQuestion++;
                loadQuestion();
            } else {
                showGameResult();
            }
        }

        function showPhase(phase) {
            document.getElementById('phase1').style.display = phase === 1 ? 'block' : 'none';
            document.getElementById('phase2').style.display = phase === 2 ? 'block' : 'none';
            document.getElementById('phase3').style.display = phase === 3 ? 'block' : 'none';
        }

        function showGameResult() {
            document.getElementById('gameContainer').style.display = 'none';
            document.getElementById('resultContainer').style.display = 'block';

            const totalQuestions = questions.length;
            document.getElementById('finalScore').textContent = `${totalQuestions}/${totalQuestions}`;
            document.getElementById('resultMessage').textContent = 'ãƒã‚¸ãƒƒã‚¯ãƒ¯ãƒ¼ãƒ‰ã‚’å¤‰æ›ã—ãŸæ–‡ç« ãŒå®Œæˆã—ã¾ã—ãŸã€‚è¿‘ãã®äººã¨å…±æœ‰ã—ã¾ã—ã‚‡ã†ã€‚ğŸ‰';

            // å…¨çµæœã‚’è¡¨ç¤º
            let resultsHTML = '<div style="margin-top: 30px; text-align: left;">';
            allResults.forEach((result, index) => {
                resultsHTML += `
                    <div style="margin-bottom: 20px; padding: 15px; background: #f9f9f9; border-radius: 10px;">
                        <div style="font-weight: bold; color: #667eea; margin-bottom: 10px;">å•é¡Œ ${index + 1}:</div>
                        <div style="font-size: 16px; line-height: 1.8; color: #333;">${result}</div>
                    </div>
                `;
            });
            resultsHTML += '</div>';

            document.getElementById('resultContainer').insertAdjacentHTML('beforeend', resultsHTML);
        }

        function restart() {
            // çµæœè¡¨ç¤ºã® HTML ã‚’å‰Šé™¤
            const resultsDiv = document.querySelector('#resultContainer > div[style*="margin-top: 30px"]');
            if (resultsDiv) {
                resultsDiv.remove();
            }

            document.getElementById('resultContainer').style.display = 'none';
            document.getElementById('gameContainer').style.display = 'block';
            allResults = [];
            init();
        }

        // Event Listeners
        document.getElementById('phase1NextBtn').addEventListener('click', phase1Next);
        document.getElementById('phase2BackBtn').addEventListener('click', phase2Back);
        document.getElementById('phase2NextBtn').addEventListener('click', phase2Next);
        document.getElementById('phase3BackBtn').addEventListener('click', phase3Back);
        document.getElementById('phase3NextBtn').addEventListener('click', phase3Next);
        document.getElementById('restartBtn').addEventListener('click', restart);

        // Initialize
        init();
    </script>
</body>
</html>
